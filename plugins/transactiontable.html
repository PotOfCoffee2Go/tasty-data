<script>
  getSymbolTransactions = (symbol) => {
    let selected = {data: webdocdown.data.store.tastyTransactionDetails.data
      .filter(d => d.Symbol === symbol)};
    if (selected.data.length) return selected;
    return webdocdown.data.store.tastyTransactionDetails;
  };

  document.querySelector('#symbol-select').addEventListener('change', (event) => {
    markupTransactions(event.target.value);
  }, false);

  markupTransactions = (symbol = '') => {
    let data = webdocdown.data.store.tastyTransactionDetails.data;

    if (!symbol) {
      // Symbol selection element
      const unique = [];
      data.map(x => unique.filter(a => a.Symbol === x.Symbol).length > 0
        ? null : unique.push({Symbol: x.Symbol}));

      unique.push({Symbol: '--all--'});
      unique.sort((a, b) => (a.Symbol > b.Symbol ? 1 : -1));

      document.getElementById('symbol-select').innerHTML =
        unique.filter(u => u.Symbol).map(u =>
          '<option value="' + u.Symbol + '">' + u.Symbol + '</option>').join('\n');
    }
    // Build transaction table
    let detailMarkup = '' +
      '| Date | Code | Symbol | Qty | Price | Amount | Strike | Expires | Call/Put |\n' +
      '| :--: | :--: | :----- | :-: | :---: | :----: | :----: | :-----: | :------: |\n' +
      '{{#data}}' +
      '| {{Date_Time}} | {{Transaction_Code}} - {{Transaction_Subcode}} |' +
      '  {{Symbol}} | {{Quantity}} |' +
      '  {{fmt.Price}} | {{fmt.Amount}} | {{fmt.Strike}} | {{Expiration_Date}} |' +
      '  {{Call_Put}} |\n' +
      '{{/data}}';

    // Sort by symbol
    // data.sort((a, b) => (a.Underlying_Symbol > b.Underlying_Symbol ? 1 : -1));

    // Produce and display table of portfolio data
    webdocdown.produceWBDD(detailMarkup, getSymbolTransactions(symbol))
      .then((html) => document.getElementById('transaction-detail').innerHTML = html)
  }
</script>

<style>
  #transaction-detail table, #transaction-detail th, #transaction-detail td {
    padding: 4px;
    border: 1px solid black;
    border-collapse: collapse;
  }
  #transaction-detail table {
    margin-left:auto;
    margin-right:auto;
  }
  #transaction-detail th {
    color: black;
  }
</style>
