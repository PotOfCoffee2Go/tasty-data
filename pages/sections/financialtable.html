::div #financial-data tx-darkblue::

<script>
    // Helpers
    const  round = (nbr, places) =>
        Math.round(nbr * Math.pow(10, places)) / Math.pow(10, places),
      format = (nbr, places) => parseFloat(round(nbr, places)).toFixed(places),
      maybeRedParens = (nbr, places) =>
        nbr < 0
          ? "::tx-darkred::_(" + format(nbr * -1, places) + ")_"
          : "::tx-darkblue::_" + format(nbr, places) + "_";

  markupFinancialData = () => {
    let summaryMarkup =
      "| Account | Gain | Fees | Cash | Portfolio | Value |\n" +
      "| :--: | :--: | :--: | :---: | :---: | :---: |\n" +
      "| {{cashsums.Amount}} | {{possums.fmt.Gain}} | {{calc.fees}} | {{calc.cash}} |" +
      " {{calc.portfolio}} | {{calc.value}} |\n";

    let detailMarkup =
      "Account Activity\n\n" +
      "| Date | Code | Subcode | Amount |\n" +
      "| :--- | :--: | :-----: | :----: |\n" +
      "{{#data}}" +
      "| {{{fmt.Date_Time}}} | {{fmt.Code}} | {{fmt.Subcode}} | {{fmt.Amount}} |" +
      "  \n" +
      "{{/data}}" +
      "| Totals | - | - | {{cashsums.Amount}} |\n";

    // Reference closed data and sums from localStorage
    const data = webdocdown.data.store.tastyFinancialData.data;
    const cashsums = webdocdown.data.store.tastyFinancialSums;
    const possums = webdocdown.data.store.tastyPositionSums;
    const portsums = webdocdown.data.store.tastyPortfolioSums;
    const calc = {
      cash: maybeRedParens(cashsums.Amount + possums.Gain - possums.Fees, 2),
      fees: maybeRedParens(-possums.Fees, 2),
      portfolio: portsums.fmt.Gain,
      value: maybeRedParens(cashsums.Amount + possums.Gain - possums.Fees + portsums.Gain, 2),
    };

    console.log('portsums', portsums);
    console.log('possums', possums);

    // Sort by Date/Time
    data.sort((a, b) => (a.Time < b.Time ? 1 : -1));

    // Produce and display table of financial data
    let tablesOutput = '';
    webdocdown
      .produceWBDD(summaryMarkup, { data, cashsums, possums, calc })
      .then((html) => tablesOutput = ('<div>' + html + '</div>'))
      .then(() => webdocdown.produceWBDD(detailMarkup, { data, cashsums, possums, calc }))
      .then((html) => tablesOutput += ('<div>' + html + '</div>'))
      .then(
        () => (document.getElementById("financial-data").innerHTML = tablesOutput)
      );
  };
</script>

<style>
  #financial-data table,
  #financial-data th,
  #financial-data td {
    padding: 4px;
    border: 1px solid black;
    border-collapse: collapse;
  }
  #financial-data table {
    margin-left: auto;
    margin-right: auto;
  }
  #financial-data th {
    color: black;
  }
  #financial-data tbody tr:last-child {
    background: #e8e8e8;
  }
  #financial-data tr td a {
    cursor: pointer;
  }
</style>
