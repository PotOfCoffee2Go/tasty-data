::div #financial-data tx-darkblue::

<script>
    // Helpers
    const  round = (nbr, places = 0) =>
        Math.round(nbr * Math.pow(10, places)) / Math.pow(10, places),
      format = (nbr, places = 0) => parseFloat(round(nbr, places)).toFixed(places),
      maybeRedParens = (nbr, places = 0) =>
        nbr < 0
          ? "::tx-darkred::_(" + format(nbr * -1, places) + ")_"
          : "::tx-darkblue::_" + format(nbr, places) + "_";

  markupFinancialData = () => {
    let summaryMarkup =
      "Summary\n\n" +
      "| Account | Gain | Positions | Cash | Liquid | Liquidate | Fees |\n" +
      "| :-----: | :--: | :-------: | :--: | :----: | :-------: | :--: |\n" +
      "| {{calc.account}} | {{calc.gain}} | {{calc.positions}} |" +
      " {{calc.cash}} | {{calc.liquidity}} | {{calc.liquidate}} | {{calc.fees}} |\n";

    // Reference closed data and sums from localStorage
    const cashsums = webdocdown.data.store.tastyFinancialSums;
    const possums = webdocdown.data.store.tastyPositionSums;
    const portsums = webdocdown.data.store.tastyPortfolioSums;

    const cash = cashsums.Amount + possums.Gain - possums.Fees + possums.PosCost;
    const calc = {
      account: maybeRedParens(cashsums.Amount, 2),
      gain: maybeRedParens(possums.Gain, 2),
      positions: maybeRedParens(possums.PosCost, 2),
      cash: maybeRedParens(cash, 2),
      liquidity: maybeRedParens(portsums.Gain, 2),
      liquidate: maybeRedParens(cash - possums.PosCost + portsums.Gain, 2),
      fees: maybeRedParens(-possums.Fees, 2),
    };

    let detailMarkup =
      "Account Activity\n\n" +
      "| Date | Code | Subcode | Amount |\n" +
      "| :--: | :--: | :-----: | :----: |\n" +
      "{{#data}}" +
      "| {{{fmt.Date_Time}}} | {{fmt.Code}} | {{fmt.Subcode}} | {{fmt.Amount}} |" +
      "  \n" +
      "{{/data}}" +
      "| Totals | - | - | {{cashsums.Amount}} |\n";

    const data = webdocdown.data.store.tastyFinancialData.data;

    // Sort by Date/Time
    data.sort((a, b) => (a.Time < b.Time ? 1 : -1));

    // Produce and display tables of financial data
    let tablesOutput = '';
    webdocdown
      .produceWBDD(summaryMarkup, { data, cashsums, possums, calc })
      .then((html) => tablesOutput = ('<div>' + html + '</div>'))
      .then(() => webdocdown.produceWBDD(detailMarkup, { data, cashsums, possums, calc }))
      .then((html) => tablesOutput += ('<div>' + html + '</div>'))
      .then(
        () => (document.getElementById("financial-data").innerHTML = tablesOutput)
      );
  };
</script>

<style>
  #financial-data table,
  #financial-data th,
  #financial-data td {
    padding: 4px;
    border: 1px solid black;
    border-collapse: collapse;
  }
  #financial-data table {
    margin-left: auto;
    margin-right: auto;
  }
  #financial-data th {
    color: black;
  }
  #financial-data tbody tr:last-child {
    background: #e8e8e8;
  }
  #financial-data tr td a {
    cursor: pointer;
  }
</style>
